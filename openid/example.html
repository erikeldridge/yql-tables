<a id="openid">click</a>
<script src="http://yui.yahooapis.com/3.0.0/build/yui/yui-min.js"></script>
<script>
    YUI( {
        modules: {
            'gallery-storage-lite': {
                fullpath: 'http://yui.yahooapis.com/gallery-2010.02.22-22/build/gallery-storage-lite/gallery-storage-lite-min.js',
                requires: ['event-base','event-custom','event-custom-complex','json'],
                optional: [],
                supersedes: []
          }

        }
    } ).use('io', 'gallery-storage-lite', function (Y) {
        var handleIoComplete = function (id, o, args) {
                var json = Y.JSON.parse(o.responseText);
                Y.Node.get('#openid').set('href', json.query.results.success);
            },
            handleStorageReady = function () {
                var returnTo = 'example.com',
                    githubAcct ='erikeldridge',
                    assocHandle = Y.StorageLite.getItem('openid-assoc', true).query.results.success.assoc_handle,
                    params = [
                        'q='+encodeURIComponent('use "http://github.com/'+githubAcct+'/yql-tables/raw/master/openid/openid.xml" as table; '
                            + 'select * from table where '
                            + 'id="yahoo.com" and '
                            + 'return_to="http://'+returnTo+'" and '
                            + 'assoc_handle="'+assocHandle+'"'),
                        'callback=',
                        'diagnostics=false',
                        'format=json',
                        'debug=true'
                    ],
                    url = "http://query.yahooapis.com/v1/public/yql?"+params.join('&'),
                    ioConfig = {
                        method: 'GET',
                        on: {
                            success: handleIoComplete
                        },
                        xdr: {
                            use: 'flash'
                        }
                    },
                    xdrConfig = {
                        id:'flash',
                        yid: Y.id, 
                        src:'../../../../io.swf'
                    };

                    Y.io.transport(xdrConfig);

                    Y.on('io:xdrReady', function () {
                        Y.io(url, ioConfig);
                    });
            };
            
        //run test.assoc.html first to store assoc fields
        Y.StorageLite.on( 'storage-lite:ready', handleStorageReady );
            

    });
</script>